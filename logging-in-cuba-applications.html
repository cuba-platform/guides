<!doctype html>
<!--[if IE 9]>
<html class="lt-ie10" lang="en"> <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logging in CUBA applications</title>
    <meta name="description" content="The CUBA Platform guides cover different aspects of the CUBA Platform and give you advice on how to work with CUBA Platform by giving you concrete examples.">
    <meta name="author" content="Haulmont">
    <link rel="stylesheet" href="/guides/css/foundation.css">
    <link rel="stylesheet" href="/guides/css/font-awesome.css">
    <link rel="stylesheet" href="/guides/css/coderay.css">
    <link rel="stylesheet" href="/guides/css/asciidoctor.css">
    <link rel="stylesheet" href="/guides/css/cuba.css">
    <script src="/guides/js/vendor/modernizr.js"></script>
    <script src="/guides/js/toc.js"></script>
</head>
<body>


<!-- Nav Bar -->

<!--<nav class="top-bar" data-topbar>-->
    <!--<ul class="title-area">-->
        <!--&lt;!&ndash; Title Area &ndash;&gt;-->
        <!--<li class="name">-->
            <!--<h1>-->
                <!--<a href="../../../">CUBA Platform guides</a>-->
            <!--</h1>-->
        <!--</li>-->
        <!--<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>-->
    <!--</ul>-->
<!--</nav>-->
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->

<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns" role="content">

        <h1>Logging in CUBA applications</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In order to get insights into a running CUBA application, Logging is one crucial part to get in place. The Java ecosystem has a very mature mechanisms to do application logging. This guide show how this ecosystem can be leveraged in a CUBA application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_will_be_build">What will be build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guides enhances the <a href="https://github.com/cuba-platform/cuba-petclinic">CUBA petclinic</a> example to show how logging can be integrated, configured and viewed as part of the application itself or with the help of external tools.</p>
</div>
<div class="sect2">
<h3 id="final_application">Final Application</h3>
<a href="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-intro-to-datamanager/master/img/adjustments-cuba-petclinic-overview.gif"><img src="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-intro-to-datamanager/master/img/login-screen.png"/></a>
<div class="paragraph">
<p>Unresolved directive in 2018-12-12-logging-in-CUBA-applications.adoc - include::/includes/guide_requirements.adoc[]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example_cuba_petclinic">Example: CUBA petclinic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The project that is the basis for this example is <a href="https://github.com/cuba-platform/cuba-petclinic">CUBA Petclinic</a>. It is based on the commonly known <a href="https://github.com/spring-projects/spring-petclinic">Spring Petclinic</a>. The CUBA Petclinic application deals with the domain of a Pet clinic and the associated business workflows to manage a pet clinic.</p>
</div>
<div class="paragraph">
<p>The underlying domain model for the application looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/guides/images/domain-model.png" alt="Domain model">
</div>
</div>
<div class="paragraph">
<p>The main entities are <strong>Pet</strong> and <strong>Visit</strong>. A Pet is visiting the petclinic and during this Visit, a Vet will take care of it. A Pet belongs to a Owner, which can hold multiple pets. The visit describes the act of a pet visiting the clinic with the help of its owner.</p>
</div>
<a href="https://raw.githubusercontent.com/cuba-platform/cuba-petclinic/master/img/cuba-petclinic-overview.gif"><img src="https://raw.githubusercontent.com/cuba-platform/cuba-petclinic/master/img/login-screen.png"/></a>
</div>
</div>
<div class="sect1">
<h2 id="why_application_logging_is_essential">Why application logging is essential</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging information about the running application is essential in order to get insights on how the application behaves, what unexpected behavior occurs and how the users are interacting with the system.</p>
</div>
<div class="paragraph">
<p>Logging is a common pattern of application development. The developer writes statements into the application source code indicating that certain actions happened. In the following example two possible log messages are written. In case of a successful saving of the <code>Pet</code> instance, an informal message is written with the details of the pet that has been stored. In case of a failure of storing the Pet, an error message is written with information about the failure.</p>
</div>
<div class="listingblock">
<div class="title">PetServiceBean.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> Pet savePet(Pet pet) {
    <span class="keyword">try</span> {
      Pet savedPet = dataManager.commit(pet);
      log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pet </span><span class="delimiter">&quot;</span></span> + pet + <span class="string"><span class="delimiter">&quot;</span><span class="content"> was saved correctly</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">return</span> savedPet;
    }
    <span class="keyword">catch</span>(<span class="exception">Exception</span> e) {
      log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pet </span><span class="delimiter">&quot;</span></span> + pet + <span class="string"><span class="delimiter">&quot;</span><span class="content"> could not be saved</span><span class="delimiter">&quot;</span></span>, e);
      <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Those messages will be written in a configured place that some administrator or developer has access to for later use. Normally this are plain text files, but it is also possible to store the logging information in a Database or a centralized logging service.</p>
</div>
<div class="paragraph">
<p>For development purposes the developer normally has the ability to debug the source code. For a running application this is normally not the case. Either because of security reasons or simply because the application is not run on a server that is under the control of the developer.</p>
</div>
<div class="paragraph">
<p>Therefore logging is the another tool in the toolbox of a developer in order to do diagnostics of a running application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_java_logging_ecosystem">The Java logging ecosystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the Java ecosystem logging has (as in a lot of other ecosystems as well) played a substantial role. There are various mechanisms and abstractions out there on how to actually interact with the logging mechanisms of the platform the application is running on.</p>
</div>
<div class="paragraph">
<p>Mainly these are various APIs of the JVM and different logging libraries that encapsulate the technical concern of logging to a file / database from the abstraction of "writing a log message".</p>
</div>
<div class="paragraph">
<p>In recent years a commonly used combination has been adopted in the Java ecosystem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Slf4J</p>
</li>
<li>
<p>Logback</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Slf4J is an abstract API that encapsulates the concrete details of the logging library. It offers different methods for logging information to the logging system with different servity levels (<code>DEBUG</code>, <code>INFO</code>, <code>WARN</code> etc.).</p>
</div>
<div class="paragraph">
<p>Logback on the other hand is the logging library that fulfils this API and does the heavy lifting of writing the message to a log appender. It contains the options to configure where the log messages should go to.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how_to_log_in_a_cuba_application">How to log in a CUBA application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The usage of logging libraries within a CUBA application does not differ from other Java application in this regard. CUBA is by default configured with Sl4fJ and Logback in place. The framework itself uses logback for framework internal logging messages. In order to log information within a class, an instance of a Logger has to be created in the class that wants to log information.</p>
</div>
<div class="listingblock">
<div class="title">PetEdit.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@UiController</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">petclinic_Pet.edit</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@UiDescriptor</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">pet-edit.xml</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@LoadDataBeforeShow</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PetEdit</span> <span class="directive">extends</span> StandardEditor&lt;Pet&gt; {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(PetEdit.class); <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Subscribe</span>
    <span class="directive">protected</span> <span class="type">void</span> onInit(InitEvent event) {
        log.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pet editor opened</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Logger configured for this class is defined through Slf4J</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>write debug log message when opening the screen</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="view_log_messages_through_cuba_ui">View log messages through CUBA UI</h3>
<div class="paragraph">
<p>There are several ways to get access to the log output of the running application. The most common way is a log file within the filesystem of the server. Unfortunately this oftentimes requires special permissions and knowledge to get access to.</p>
</div>
<div class="paragraph">
<p>CUBA offers a user interface screen, which displays the log information of the running application. It can be found via <code>Administration &gt; Server Log</code>:</p>
</div>
<a href="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-application-logging/master/img/cuba-server-log-messages.png"><img src="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-application-logging/master/img/cuba-server-log-messages.png"/></a>
<div class="paragraph">
<p>The UI allows the user to display different log files or download them for later use. It gives also non-administrator roles access to the logs.</p>
</div>
</div>
<div class="sect2">
<h3 id="logging_levels">Logging Levels</h3>
<div class="paragraph">
<p>Information that should be logged are of different types in multiple dimensions. In order to reason about the messages quickly and help the log message reader to distinguish between signal and noise, all logging libraries offer one very important dimension to categorize the messages: the Log level.</p>
</div>
<div class="paragraph">
<p>The log level can be seen as how critical the message is. It is important to note that the log levels ordered and are based on each other.</p>
</div>
<div class="paragraph">
<p>Slf4J allows to define the following logging levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TRACE</p>
</li>
<li>
<p>DEBUG</p>
</li>
<li>
<p>INFO</p>
</li>
<li>
<p>WARN</p>
</li>
<li>
<p>ERROR</p>
</li>
<li>
<p>FATAL</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adjust_logging_configuration">Adjust logging configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logback (alongside with other logging libraries) allows customization on how and where the log information it processed and written to an output.</p>
</div>
<div class="paragraph">
<p>Generally there are two options to adjust the configuration of logback. On the one side there is a configuration file called <code>logback.xml</code> where the configuration can be expressed. This adjustments happen at deployment time. Alternatively logback can (to a certain extend) be configured at runtime. CUBA offers a UI for adjusting logging configuration for this purpose (<code>Administration &gt; Server Log</code>).</p>
</div>
<div class="sect2">
<h3 id="at_deployment_logback_xml_configuration_file">At deployment: logback.xml configuration file</h3>
<div class="paragraph">
<p>The configuration file <code>logback.xml</code> is the main place to adjust the configuration of logback. In a CUBA application this file is located in <code>deploy/tomcat/conf/logback.xml</code> (in case of <a href="http://fixMe">fast deployment</a> option). It looks like this:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration</span> <span class="attribute-name">debug</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">packagingData</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">logDir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${catalina.base}/logs</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;appender</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">File</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ch.qos.logback.core.rolling.RollingFileAppender</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;file&gt;</span>${logDir}/app.log<span class="tag">&lt;/file&gt;</span>

        <span class="tag">&lt;filter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ch.qos.logback.classic.filter.ThresholdFilter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;level&gt;</span>DEBUG<span class="tag">&lt;/level&gt;</span>
        <span class="tag">&lt;/filter&gt;</span>

        <span class="tag">&lt;encoder&gt;</span>
            <span class="tag">&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread%X{cubaApp}%X{cubaUser}] %logger - %msg%n<span class="tag">&lt;/pattern&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tag">&lt;/encoder&gt;</span>
    <span class="tag">&lt;/appender&gt;</span>

    <span class="tag">&lt;appender</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Console</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ch.qos.logback.core.ConsoleAppender</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tag">&lt;encoder&gt;</span>
            <span class="tag">&lt;pattern&gt;</span>%d{HH:mm:ss.SSS} %-5level %-40logger{36}- %msg%n<span class="tag">&lt;/pattern&gt;</span>
        <span class="tag">&lt;/encoder&gt;</span>
    <span class="tag">&lt;/appender&gt;</span>

    <span class="tag">&lt;root&gt;</span>
        <span class="tag">&lt;appender-ref</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Console</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;appender-ref</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">File</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/root&gt;</span>

    <span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.haulmont.sample.petclinic</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DEBUG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.haulmont.cuba</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DEBUG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.haulmont.cuba.core.sys</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">INFO</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- ... --&gt;</span>

<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a file appender to write log messages to the logfile <code>app.log</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>pattern</code> configures how a single log message line within the file should look like</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>another appender writes the log messages to <code>STDOUT</code> (with different options)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>logging levels can be configured on a per class / package basis</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>CUBA by default configures multiple log appender. An appender describes where the log information should be written to. There are multiple appender available out of the box. Each appender has options to configure its behavior (like how the log message should be formatted, which information should be logged etc.). Common Log appender are <code>FileAppender</code>, <code>ConsoleAppender</code> or <code>DatabaseAppender</code>.</p>
</div>
<div class="paragraph">
<p>The configuration of loggers allow to define on a per class / package basis the threshold. This means that for certain sub-parts of the application, it is possible to get log messages that have been written as <code>DEBUG</code> while for certain other application parts it is only necessary to see log messages of <code>WARN</code> and <code>ERROR</code>.</p>
</div>
<div class="paragraph">
<p>In the example above the package`com.haulmont.sample.petclinic` is set to level <code>DEBUG</code>. This means, that it will output all log messages that have <em>at least</em> the level <code>DEBUG</code>. Due to the semantic order of the log levels <code>INFO</code>, <code>WARN</code>, <code>ERROR</code> and <code>FATAL</code> will also be logged for this package. <code>TRACE</code> log messages on the other hand will not be displayed.</p>
</div>
</div>
<div class="sect2">
<h3 id="at_runtime_cuba_logging_ui">At runtime: CUBA logging UI</h3>
<div class="paragraph">
<p>Adjusting the configuration of the file requires a restart of the application. For temporary debugging sessions it is oftentimes helpful to not have to restart the server only to adjust the logging level or a certain subpart of the application code.</p>
</div>
<div class="paragraph">
<p>For this use-case a CUBA application allows to reconfigure the levels of existing loggers and also add loggers at runtime trough a user interface.</p>
</div>
<a href="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-application-logging/master/img/cuba-server-log-settings.png"><img src="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-application-logging/master/img/cuba-server-log-settings.png"/></a>
</div>
<div class="sect2">
<h3 id="set_logging_context_with_mdc">Set logging context with MDC</h3>
<div class="paragraph">
<p>Once the application has certain amount of logging information certain information get repeated in a lot of logging messages. In the petclinic example a lot of log messages would contain the Pet ID in order to get the context information in a fast manner. For those kinds of information, there is a context in Logback, called <em>MDC</em>.</p>
</div>
<div class="paragraph">
<p>MDC allows to set certain values into a context, that gets logged every time alongside with the actual logging message. This way the context can be set once and the developer writing the actual logging statement does not need to include it into the log message anymore.</p>
</div>
<div class="paragraph">
<p>In the example of the petclinic, the <code>PetContactFetcherBean</code> leverages the MDC context in the following manner: Directly after invoking the method <code>Optional&lt;Contact&gt; findContact(Pet pet)</code> the identification number of the Pet is set into the MDC context like this:</p>
</div>
<div class="listingblock">
<div class="title">PetContactFetcherBean.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(PetContactFetcher.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PetContactFetcherBean</span> <span class="directive">implements</span> PetContactFetcher {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(PetContactFetcherBean.class);


    <span class="annotation">@Override</span>
    <span class="directive">public</span> Optional&lt;Contact&gt; findContact(Pet pet) {

        MDC.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">petId</span><span class="delimiter">&quot;</span></span>, pet.getIdentificationNumber()); <i class="conum" data-value="1"></i><b>(1)</b>

        log.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">Searching Contact for Pet</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>

        Optional&lt;<span class="predefined-type">Owner</span>&gt; petOwner = loadOwnerFor(pet);

        <span class="keyword">if</span> (petOwner.isPresent()) {
            log.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">Found Owner: {}</span><span class="delimiter">&quot;</span></span>, petOwner);

            <span class="comment">// ...</span>

            <span class="keyword">if</span> (isAvailable(telephone)) {
                <span class="keyword">return</span> createContact(telephone, ContactType.TELEPHONE);
            }

            <span class="comment">// ...</span>

        } <span class="keyword">else</span> {
            <span class="keyword">return</span> Optional.empty();
        }
    }

    <span class="directive">private</span> Optional&lt;Contact&gt; createContact(<span class="predefined-type">String</span> contactValue, ContactType contactType) {

        Contact contact = <span class="keyword">new</span> Contact();
        contact.setValue(contactValue);
        contact.setType(contactType);

        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Contact created: {}</span><span class="delimiter">&quot;</span></span>, contact); <i class="conum" data-value="3"></i><b>(3)</b>

        MDC.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">petId</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="4"></i><b>(4)</b>

        <span class="keyword">return</span> Optional.of(contact);
    }

    <span class="comment">// ...</span>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the Pets identification number is registered in the context under the key <code>petId</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the following logging messages do not need to include the Pet ID within the log message itself</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the lifetime of a value in the MDC is independent of method boundaries</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the key <code>petId</code> of the MDC is cleaned up at the end of the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that the MDC has values in it, the next step is to reconfigure logback in order to see the dedicated MDC values in the log output.</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;configuration</span> <span class="attribute-name">debug</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">packagingData</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- ... --&gt;</span>

    <span class="tag">&lt;appender</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">File</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ch.qos.logback.core.rolling.RollingFileAppender</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="comment">&lt;!-- ... --&gt;</span>

        <span class="tag">&lt;encoder&gt;</span>
            <span class="tag">&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread%X{cubaApp}%X{cubaUser}] [Pet: %X{petId}] %logger - %msg%n<span class="tag">&lt;/pattern&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;/encoder&gt;</span>

    <span class="tag">&lt;/appender&gt;</span>

    <span class="comment">&lt;!-- ... --&gt;</span>

<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>%X{petId}</code> takes the value with the key <code>petId</code> of the MDC and writes it to the log file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting logging output contains the Pet identification number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">2018-12-13 08:54:41.345 DEBUG [http-nio-8080-exec-7/petclinic/admin] [Pet: 205] c.h.s.p.c.PetContactFetcherBean - Searching Contact for Pet
2018-12-13 08:54:41.354 DEBUG [http-nio-8080-exec-7/petclinic-core/admin] [Pet: 205] c.h.c.c.a.RdbmsStore - load: metaClass=petclinic_Owner, id=79fa17b9-a130-207d-5091-f79cceb9cf99, view=com.haulmont.sample.petclinic.entity.owner.Owner/_local
2018-12-13 08:54:41.371 DEBUG [http-nio-8080-exec-7/petclinic/admin] [Pet: 205] c.h.s.p.c.PetContactFetcherBean - Found Owner: Optional[com.haulmont.sample.petclinic.entity.owner.Owner-79fa17b9-a130-207d-5091-f79cceb9cf99 [detached]]
2018-12-13 08:54:41.374 INFO  [http-nio-8080-exec-7/petclinic/admin] [Pet: 205] c.h.s.p.c.PetContactFetcherBean - Contact created: TELEPHONE: 0049817312</code></pre>
</div>
</div>
<div class="paragraph">
<p>The log entries now contain the following part of the message: <code>[Pet: 205]</code>. This context entry is also used for CUBA internal logging messages like the logging message of the <code>RdbmsStore</code>.</p>
</div>
<div class="paragraph">
<p>MDC has the following advantages over putting context values directly into the log message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>log messages are homogeneous for all logging messages</p>
</li>
<li>
<p>log messages are structured allowing for explicit search</p>
</li>
<li>
<p>the definition of the context can be extracted into a single place of the source code</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logging_to_centralized_logging_solution">Logging to centralized Logging solution</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging is an essential part for developers and administrators to reason about a running application. It enables developers to observe a system through opening up the "black-box" and get valuable insights. The use cases go from debugging over performance analysis to observing user behavior.</p>
</div>
<div class="paragraph">
<p>The logging facilities in the Java and CUBA ecosystem are very mature and can be used without any friction. But as the logging API is so generic and usable in multiple ways, it heavily depends on conventions in order to get qualitative logging messages in the application. There are different mechanisms to not get overwhelmed by raw logging messages through proper logging configuration, diagnosis contexts (MDC) and logging levels.</p>
</div>
<div class="paragraph">
<p>CUBA offers an opinionated way of dealing with logging configuration and access to logs. But as it is based on standard Java logging mechanism it plays nicely with other solutions like centralized logging systems.</p>
</div>
</div>
</div>

    </div>

    <!-- End Main Content -->

    <!-- Sidebar -->

    <aside class="large-3 columns">

        <br />
        <br />

        <div class="panel">
            <h4>CUBA Version</h4>
            <b>7.0</b>
        </div>

        <div class="panel">
            <h4>Get the code</h4>

            <a class="button expanded"  href="https://github.com/cuba-guides/cuba-petclinic-application-logging/archive/master.zip">Download</a>
            <a href="https://github.com/cuba-guides/cuba-petclinic-application-logging">Github Repository</a>
        </div>

        <div class="panel">
            <h3>Table of contents</h3>
            <ul class="sectlevel1">
<li><a href="#what_will_be_build">What will be build</a></li>
<li><a href="#example_cuba_petclinic">Example: CUBA petclinic</a></li>
<li><a href="#why_application_logging_is_essential">Why application logging is essential</a></li>
<li><a href="#the_java_logging_ecosystem">The Java logging ecosystem</a></li>
<li><a href="#how_to_log_in_a_cuba_application">How to log in a CUBA application</a></li>
<li><a href="#adjust_logging_configuration">Adjust logging configuration</a></li>
<li><a href="#logging_to_centralized_logging_solution">Logging to centralized Logging solution</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
        </div>

    </aside>

    <!-- End Sidebar -->
</div>

<!-- End Main Content and Sidebar -->


<!-- Footer -->

<footer class="row">
    <div class="large-12 columns">
        <hr>
        <div class="row">
            <div class="large-12 columns">
                <p>Copyright &#169; 2008-2018 Haulmont</p>
            </div>
        </div>
    </div>
</footer>

<script src="/guides/js/vendor/jquery.js"></script>
<script src="/guides/js/foundation.min.js"></script>
<script src="https://unpkg.com/isotope-layout@3.0/dist/isotope.pkgd.js"></script>
<script>
$(document).foundation();
var doc = document.documentElement;
doc.setAttribute('data-useragent', navigator.userAgent);
</script>
</body>
</html>
