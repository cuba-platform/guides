---
compatible_cuba_versions: 7.0+
compatible_java_versions: 8+
project_id: cuba-petclinic-working-with-images
permalink: working-with-images
---
= Working with Images in CUBA applications
:showtitle:
:sectlinks:
:sectanchors:
:page-navtitle: Working with Images in CUBA applications
:page-excerpt: In this guide several ways will be explored on how to interact with images in a CUBA application
:page-root: ../../../
:project_id: cuba-petclinic-working-with-images
:java_version: 1.8
:cuba_version: 7.0


In a CUBA application it is possible to interact with images in various ways. In this guide, examples will be shown on how
to upload and display images in the application. It will also be shown how to attach those images to entities and providing
 the user the ability to download the image files from the application.

== What Will be Built

This guide enhances the https://github.com/cuba-platform/cuba-petclinic[CUBA Petclinic] example to allow the user to attach with images to entities and interact with them. In particular the following changed will be made:

* allow to upload an image for a Veterinarian
* render the vets image in the vets browse table
* create custom lookup-like component that shows the vets image next to the vets name
* ability to attach x-ray images to a visit and show a preview of the images

=== Final Application

++++
<a href="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-working-with-images/master/img/adjustments-cuba-petclinic-overview.gif"><img src="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-working-with-images/master/img/login-screen.png"/></a>
++++

include::includes/guide_requirements.adoc[]


include::includes/petclinic_introduction.adoc[]


== CUBAs File Storage Subsystem Handles File Interactions

CUBA has a comprehensive set of features, that deal with the task of interacting with files within an application called `File Storage`.
This set of APIs allow the developer to fulfill the end-to-end process of working with files. It contains mainly:

* ability to let the users upload files
* store references from business entities to files
* read & write files in the application
* ability to let users download files

The implementation of the File Storage subsystem separates the storage of the file metadata from the file binary. It stores
metadata about the file in the relational database and the raw file binary in the local filesystem.

More information about this topic can be found in the reference documentation on https://doc.cuba-platform.com/manual-{cuba_version}/file_storage.html[File Storage].

As an Image is just a particular type of a file, it is possible to treat the image handling just like any other kind of file handling with some specific additional behavior like preview in the browser.

== Veterinarians Avatar Image

The first example of this Images guide allows the users to upload & display an avatar image for a particular veterinarian.

In order to achieve this behavior, the data model of the Petclinic example needs to be enhanced, to store a reference to a file for the `Vet` entity. The corresponding JPA entity that is bundled in CUBA itself is called `FileDescriptor`, which represents the metadata part of the file representation. The association type is `MANY-TO-ONE`. In the Studio entity designer, the result looks like this:

image::working-with-images/vet-entity-file-descriptor-reference.png[align="center"]

Once the entity model contains the reference to the `FileDescriptor` entity, the attribute `image` has to be added to the view, in order to interact with this attribute in the UI.

The view `vet-with-specialties` for the `Vet` entity, that is used within the Vet editor, has to be changed to contain the `image` attribute like this:


.views.xml
[source,xml]
----
<view class="com.haulmont.sample.petclinic.entity.vet.Vet"
      extends="_local"
      name="vet-with-specialties-and-image">
    <property name="specialties"
              view="_minimal"/>
    <property name="image" view="_base" />
</view>
----

With this adjustment it makes sense to also rename the view name to `vet-with-specialties-and-image` to reflect the content of the view.

=== Upload Vets Avatar Image


With those preconditions in place, the next step is to adjust the Vet editor, so that it also contains the ability to upload an image during the process of creating / editing a Vet record.

CUBA has a built-in UI component for dealing with `FileDescriptor` instances - the FileUploadField component. This component can be added to the already existing `<form />` component from in the `vet-edit.xml` screen descriptor:

.vet-edit.xml
[source,xml]
----
<form id="fieldGroup" dataContainer="vetDc">
    <column width="250px">

        <textField property="firstName"/>
        <textField property="lastName"/>

        <upload id="imageField"
                property="image" // <1>
                fileStoragePutMode="IMMEDIATE"
                showFileName="true"
        />

    </column>
</form>
----
<1> the FileUploadField component binds to the `image` attribute of the `vetDc` data container

There are a couple of options for the upload component to control its behavior, that can be looked up in the https://doc.cuba-platform.com/manual-{cuba_version}/gui_FileUploadField.html[reference documentation]. For this use case, the default behavior is sufficient. It will allow the user during the process of creating / editing an Vet instance, to upload, remove and re-upload files and directly attach it to this particular vet instance.

The resulting user interface looks like this:

image::working-with-images/vet-entity-file-descriptor-reference-ui.png[align="center"]



=== Display Vets Avatar Image in the Browse Table

=== Create Vets Lookup Component containing the Avatar Image


== X-Ray Images for Visits

=== Create X-Ray Image Preview

=== Download X-Ray Images


== Summary


image::i18n-messages/localized-platform-screen.png[align="center"]


== Summary

== Further Information

* https://doc.cuba-platform.com/manual-{cuba_version}/messages.html[CUBA docs: Messages Interface]
* https://doc.cuba-platform.com/manual-{cuba_version}/localization.html[CUBA docs: Localization]