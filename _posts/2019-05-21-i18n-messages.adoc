---
compatible_cuba_versions: 7.0+
compatible_java_versions: 8+
project_id: cuba-petclinic-i18n-messages
permalink: localization-in-cuba-applications
---
= Localization in CUBA applications
:showtitle:
:sectlinks:
:sectanchors:
:page-navtitle: Localization in CUBA applications
:page-excerpt: In this guide the localization features of a CUBA application are explained
:page-root: ../../../
:project_id: cuba-petclinic-i18n-messages
:java_version: 1.8
:cuba_version: 7.0

...

== What Will be Built

This guide enhances the https://github.com/cuba-platform/cuba-petclinic[CUBA petclinic] example to show how localized messages within the CUBA application can be defined and used:

* ...
* ...

=== Final Application

++++
<a href="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-i18n-messages/master/img/adjustments-cuba-petclinic-overview.gif"><img src="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-i18n-messages/master/img/login-screen.png"/></a>
++++

include::includes/guide_requirements.adoc[]


include::includes/petclinic_introduction.adoc[]


== Localized Messages

CUBA applications have build-in support for localized messages for different languages.


== Where Translations are Stored in a CUBA Application

CUBA deals with translations as it is common for other Java based applications. Messages for different languages / locales are stores next to the source-code within the same package in `.properties` files.

For every language and every package there exists a file containing information on how to translate a given text into the target language. The language files contain a suffix according to the locale code of the language (e.g. `_ru` for russian, `_es` for spanish).

An example of this file structure looks like this:

```
com.haulmont.sample.petclinic.entity
|
├── owner
│   ├── Owner.java
│   └── messages.properties
├── pet
│   ├── Pet.java
│   ├── PetType.java
│   ├── messages.properties
│   ├── messages_de.properties
│   └── messages_ru.properties
├── vet
│   ├── Specialty.java
│   ├── Vet.java
│   ├── messages.properties
│   ├── messages_de.properties
│   └── messages_ru.properties
└── visit
    ├── Visit.java
    ├── VisitType.java
    ├── messages_de.properties
    ├── messages_ru.properties
    └── messages.properties
```

The properties file contains of key-value pairs, where the key is the identifier of the to be localized string and the value is the corresponding translation for the language.

The key is the same for all language files, only the value differs. In the example of the petclinic, localized entity and entity attributes names look like this:

.messages.properties
[source, java]
----
Pet.birthDate = Birth date
Pet = Pet
Pet.type = Type
Pet.owner = Owner
Pet.identificationNumber = Identification Number
PetType = Pet Type
----

.messages_de.properties
[source, java]
----
Pet.birthDate = Geburtstag
Pet = Haustier
Pet.type = Typ
Pet.owner = Tierhalter
Pet.identificationNumber = Haustier-Identifikationsnummer
PetType = Tierart
----

The example application contains translations for english, german and russian languages.

More information about the general structure of how localized messages are stored can be found in the reference documentation: https://doc.cuba-platform.com/manual-{cuba_version}/localization.html[Localization].


== Register Available Languages in the Application

In order to activate the possibility to select different languages as a user, the application needs two main configuration options in place. The first one is the activation of the language drop-down in the login screen and settings screen of the app: `cuba.localeSelectVisible`. It has to be set to `true`. The second configuration is the available languages / locales that should be available for selection: `cuba.availableLocales = English|en;German|de;Russian|ru`.

Both configurations should be placed in the `web-app.properties`. With that in place the Login screen will display the language selection box:


image::i18n-messages/login-screen-with-activated-language-selection.png[align="center"]

When logging in as a user with a given language, the application will display the translations of the corresponding language.
This happens automatically for all UI components if the corresponding translation files are in place. A `<form>` component e.g. renders the attribute captions localized:

image::i18n-messages/localized-editor.png[align="center"]


== Referencing Localized Messages

For the two cases of `<table />` and `<form />` the translation are automatically derived from the properties that should be displayed. For other UI components or messages throughout the application, there are two ways of interacting with the Localization mechanisms of CUBA: either in the XML screen definitions or programmatically from the Java code.

In order to display the correct localized message for the language the user selected, the message keys have to be referenced in the application code in order to render the correct String.

=== Referencing Messages in XML Descriptors

The first option is to reference a particular message key within XML UI descriptor. In the petclinic example, the button caption of the "regular checkup" button should be displayed in the selected language.

.visit-browse.xml
[source,xml]
----
<groupTable id="visitsTable"
            dataContainer="visitsDc"
            width="100%">
    <actions>

        <action id="createRegularCheckup"
                caption="msg://createRegularCheckup" // <1>
                icon="font-icon:BRIEFCASE" />

    </actions>
    <buttonsPanel id="buttonsPanel"
                  alwaysVisible="true">
        <button id="createForPetBtn" action="visitsTable.createRegularCheckup"/>
    </buttonsPanel>
</groupTable>
----
<1> `msg://createRegularCheckup` references the key `createRegularCheckup` through the message system `msg://`

=== Programmatic Localization of Messages

The second way of interacting with the Localization mechanism is not through the declarative XML definitions, but imperatively through Java code.

In the petclinic example, the "regular checkup" button should render the following two dynamic messages programmatically:

1. When a new Regular Checkup screen is opened, the description attribute for the visit entity should be pre-filled with a particular localized message
2. Once the Regular Checkup is created, a localized notification message should be rendered, containing the name of the pet


The first message is received via the `MessageBundle` CUBA interface. `MessageBundle` is a new shorthand mechanism of fetching a particular message from the message pack of the calling Java class.

The `Messages` interface is the alternative, that is a little more flexible and contains additional APIs, but requires to always define the package.


.VisitBrowse.java
[source,java]
----
public class VisitBrowse extends StandardLookup<Visit> {

    @Inject
    private Notifications notifications;

    @Inject
    private MessageBundle messageBundle;

    // ...

    private void createVisitForPet(Pet pet) {
        screenBuilders.editor(visitsTable)
                .newEntity()
                .withInitializer(visit -> {
                    visit.setDescription(
                        regularCheckupDescriptionContent(pet) // <1>
                    );
                    visit.setPet(pet);
                })
                .withScreenClass(RegularCheckup.class)
                .withLaunchMode(OpenMode.DIALOG)
                .withAfterCloseListener(event -> showRegularCheckupCreatedNotification(pet))
                .build()
                .show();
    }

    private String regularCheckupDescriptionContent(Pet pet) {
        return messageBundle.formatMessage( // <2>
                "regularCheckupContent", // <3>
                pet.getName(), // <4>
                pet.getIdentificationNumber()
        );
    }
----
<1> the description of the visit instance will be set on entity creation
<2> the `messageBundle` bean allows to reference translations of the current package of the corresponding Java class
<3> `regularCheckupContent` is the key of the message to be translated
<4> the next parameters `pet.getName()` and `pet.getIdentificationNumber()` are passed to the translation as parameters

If dynamic parts of a message should be rendered, the translation should contain placeholders like in this definition:


.messages_de.properties
[source,properties]
----
regularCheckupContent=Kontrolluntersuchung für %s (%s)\n\n

Bestandteile: \n
- Krallen-Kontrolle\n
- Temperatur messen\n
- Zahn-Check
----

This code results into the following description value of the regular check:

image::i18n-messages/editor-with-programmatic-created-i10n-messages.png[align="center"]


== Summary

...


== Further Information

* https://doc.cuba-platform.com/manual-{cuba_version}/messages.html[CUBA docs: Messages Interface]
* https://doc.cuba-platform.com/manual-{cuba_version}/localization.html[CUBA docs: Localization]