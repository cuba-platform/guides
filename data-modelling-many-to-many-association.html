<!doctype html>
<!--[if IE 9]>
<html class="lt-ie10" lang="en"> <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Modelling: Many-to-Many Association</title>
    <meta name="description" content="The CUBA Platform guides cover different aspects of the CUBA Platform and give you advice on how to work with CUBA Platform by giving you concrete examples.">
    <meta name="author" content="Haulmont">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@CubaPlatform">
    <meta name="twitter:creator" content="@CubaPlatform">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Data Modelling: Many-to-Many Association">
    <meta property="og:description" content="Data modelling guide: what are Many-to-Many associations and when to use them">
    <meta property="og:url" content="https://www.cuba-platform.com/guides/data-modelling-many-to-many-association">
    <meta property="og:image" content="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-data-model-many-to-many/master/img/login-screen.png">

    <link rel="shortcut icon" href="/guides/images/favicon.png" type="image/png" />
    <link rel="stylesheet" href="/guides/css/foundation.css">
    <link rel="stylesheet" href="/guides/css/font-awesome.css">
    <link rel="stylesheet" href="/guides/css/coderay.css">
    <link rel="stylesheet" href="/guides/css/bootstrap.css">
    <link rel="stylesheet" href="https://www.cuba-platform.com/sites/all/themes/cuba_adaptive/css/reset.css">
    <link rel="stylesheet" href="https://www.cuba-platform.com/sites/all/themes/cuba_adaptive/css/animate.css">
    <link rel="stylesheet" href="/guides/css/extra.css">
    <link rel="stylesheet" href="/guides/css/extra2.css">
    <link rel="stylesheet" href="/guides/css/cuba-new.css">
    <link rel="stylesheet" href="/guides/css/font-awesome.min.css">
    <link rel="stylesheet" href="/guides/css/guides.css">
    <script src="/guides/js/jquery_v2.1.min.js"></script>
    <link rel="stylesheet" href="/guides/css/main.css" />
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MH3DTWV');</script>
<!-- End Google Tag Manager -->
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-962 node-type-blog-post i18n-en">

<section id="wrapper">
    
<header role="banner" fragment="14269c1b298" class="header">
    <nav class="header_nav">
        <input id="mobile-menu-open" type="checkbox" class="header_checkbox">
        <div class="container header_container">
            <div class="header_toggle">
                <label for="mobile-menu-open"
                       class="header_toggle-label toggle-label">
                    <span>CUBA.platform</span>
                </label>
            </div>
            <a href="/" class="header_logo nuxt-link-active"></a>
            <ul class="header_menu">
                <li class="header_menu_item"><a href="/framework/" class="header_menu_link">Framework</a></li>
                <li class="header_menu_item"><a href="/learn/" class="header_menu_link nuxt-link-active">Learn</a></li>
                <li class="header_menu_item"><a href="/documentation/" class="header_menu_link">Documentation</a></li>
                <li class="header_menu_item"><a href="/discuss/" class="header_menu_link">Forum</a></li>
                <li class="header_menu_item"><a href="/blog/" class="header_menu_link">Blog</a></li>
            </ul>
            <div class="header-support">
                <button class="header-support_toggle">
                <img src="images/users.svg" class="header-support_toggle_icon">
                <span class="header-support_toggle_text">Services</span></button>
                <div class="header-support_popup">
                    <div class="support-popup">
                        <div class="support-popup_services">
                            <h3 class="support-popup_services_title">Commercial services for your project</h3>
                            <ul class="services-list">
                                <li class="services-list_item"><a href="/support-options/"><strong
                                        class="services-list_title">Consultancy &amp; Support</strong>
                                    <div class="services-list_text">
                                        <div><p>Commercial consulting requests have a guaranteed response
                                            time.</p>
                                        </div>
                                    </div>
                                </a></li>
                                <li class="services-list_item"><a href="/development/"><strong
                                        class="services-list_title">Custom Development</strong>
                                    <div class="services-list_text">
                                        <div><p>We can deliver a turn key solution or contribute to your
                                            project</p>
                                        </div>
                                    </div>
                                </a></li>
                                <li class="services-list_item"><a href="/training/"><strong
                                        class="services-list_title">Training</strong>
                                    <div class="services-list_text">
                                        <div><p>For fast and deep dive into framework features to shift your
                                            team productivity.</p>
                                        </div>
                                    </div>
                                </a></li>
                            </ul>
                        </div>
                        <div class="support-popup_haulmont">
                            <div class="support-popup_haulmont_header"><h3 class="support-popup_haulmont_title">
                                Haulmont</h3>
                                <div class="support-popup_haulmont_subtitle">we develop modern enterprise
                                    solutions
                                </div>
                            </div>
                            <ul class="haulmont-list">
                                <li class="haulmont-list_item">
                                    <div><p>Experts in Enterprise software</p>
                                    </div>
                                </li>
                                <li class="haulmont-list_item">
                                    <div><p>Creators of the CUBA Platform</p>
                                    </div>
                                </li>
                                <li class="haulmont-list_item">
                                    <div><p>Established in 2008</p>
                                    </div>
                                </li>
                            </ul>
                            <ul class="numbers-list">
                                <li class="numbers-list_item"><strong class="numbers-list_number">300+</strong>
                                    <div class="numbers-list_text">developers</div>
                                </li>
                                <li class="numbers-list_item"><strong class="numbers-list_number">400+</strong>
                                    <div class="numbers-list_text">projects</div>
                                </li>
                                <li class="numbers-list_item">
                                    <div class="numbers-list_text">Customers in</div>
                                    <strong class="numbers-list_number">60+</strong>
                                    <div class="numbers-list_text">countries</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <a href="/user/" class="header_profile">
                <svg xmlns="http://www.w3.org/2000/svg" id="i-profile" class="icon header_profile_src" viewBox="0 0 563.43 563.43" width="100%" height="100%">
                    <path d="M280.79 314.559c83.266 0 150.803-67.538 150.803-150.803S364.055 13.415 280.79 13.415 129.987 80.953 129.987 163.756s67.537 150.803 150.803 150.803zm0-261.824c61.061 0 111.021 49.959 111.021 111.021s-49.96 111.02-111.021 111.02-111.021-49.959-111.021-111.021 49.959-111.02 111.021-111.02zM19.891 550.015h523.648c11.102 0 19.891-8.789 19.891-19.891 0-104.082-84.653-189.198-189.198-189.198H189.198C85.116 340.926 0 425.579 0 530.124c0 11.102 8.789 19.891 19.891 19.891zm169.307-169.307h185.034c75.864 0 138.313 56.436 148.028 129.524H41.17c9.714-72.625 72.164-129.524 148.028-129.524z"></path>
                </svg>
            </a>
        </div>
    </nav>
    <nav class="header-submenu">
        <div class="container header-submenu_container">
            <a href="/learn/quickstart/" class="header-submenu_link">Quick Start</a>
            <a href="/learn/live-demo/" class="header-submenu_link">Live Demo</a>
            <a href="/guides/" class="header-submenu_link nuxt-link-exact-active nuxt-link-active">Guides</a>
        </div>
    </nav>
</header>

<style>
    .upper-header .header-options {
        display: none;
    }

    .upper-header .upper-header-wrapper .header-menu div .nav > li:last-child > a {
        padding-right: 0;
    }
</style>

    <!-- Main Page Content and Sidebar -->
    <div class="content-wrapper">
        <div class="cuba-container text-node blog">



            <!-- Main content (left column) -->
            <div class="region region-content">



                <section id="block-system-main" class="block block-system clearfix">
                    <div id="node-962" class="article node node-blog-post node-promoted clearfix">
                        <div class="content">
                            <div class="field field-name-body field-type-text-with-summary field-label-hidden">
                                <div class="field-items">
                                    <div class="field-item even" property="content: encoded">
                                        <h1>Data Modelling: Many-to-Many Association</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The many-to-many association implies that multiple records of one table are related to multiple records of another table. The joining table will store the primary keys of both related entities. Optionally, this table may contain additional columns.</p>
</div>
<div class="paragraph">
<p>Depending on whether additional fields in the joining table are needed, it can be implemented via a many to many association with an additional entity or without it. The following examples illustrate both approaches.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_will_be_built"><a class="anchor" href="#what_will_be_built"></a><a class="link" href="#what_will_be_built">What Will Be Built</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide enhances the <a href="https://github.com/cuba-platform/cuba-petclinic">CUBA petclinic</a> example to show different use cases of many to many associations. In particular, the following use cases will be covered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Vet</code> &#8592;&#8594; <code>Specialty</code> is modeled as a direct Many-to-Many association and the UI is updated accordingly</p>
</li>
<li>
<p><code>Pet</code> &#8592;&#8594; <code>InsuranceCompany</code> is modeled as an indirect Many-to-Many association with an explicit entity to store the validity range</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="final_application"><a class="anchor" href="#final_application"></a><a class="link" href="#final_application">Final Application</a></h3>
<a href="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-data-model-many-to-many/master/img/adjustments-cuba-petclinic-overview.gif"><img src="https://raw.githubusercontent.com/cuba-guides/cuba-petclinic-data-model-many-to-many/master/img/login-screen.png"/></a>
</div>
<div class="sect2">
<h3 id="requirements"><a class="anchor" href="#requirements"></a><a class="link" href="#requirements">Requirements</a></h3>
<div class="paragraph">
<p>Your development environment requires to contain the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://adoptopenjdk.net/">JDK 8</a></p>
</li>
<li>
<p>a text editor or IDE (<a href="https://www.jetbrains.com/idea/download/">IntelliJ IDEA</a> preferred)</p>
</li>
<li>
<p><a href="https://www.cuba-platform.com/download">CUBA Studio</a> as standalone IDE or as an IDEA plugin (optional)</p>
</li>
<li>
<p><a href="https://github.com/cuba-platform/cuba-cli/wiki/Installation">CUBA CLI</a> (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/archive/master.zip">Download</a> and unzip the source repository for this guide, or clone it using git:</p>
</div>
<div class="paragraph">
<p><code>git clone <a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many.git" class="bare">https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many.git</a></code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example_cuba_petclinic"><a class="anchor" href="#example_cuba_petclinic"></a><a class="link" href="#example_cuba_petclinic">Example: CUBA petclinic</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The project that is the basis for this example is <a href="https://github.com/cuba-platform/cuba-petclinic">CUBA Petclinic</a>. It is based on the commonly known <a href="https://github.com/spring-projects/spring-petclinic">Spring Petclinic</a>. The CUBA Petclinic application deals with the domain of a Pet clinic and the associated business workflows to manage a pet clinic.</p>
</div>
<div class="paragraph">
<p>The underlying domain model for the application looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/guides/images/domain-model.png" alt="Domain model">
</div>
</div>
<div class="paragraph">
<p>The main entities are <strong>Pet</strong> and <strong>Visit</strong>. A Pet is visiting the petclinic and during this Visit a Vet is taking care of it. A Pet belongs to an Owner, which can hold multiple pets. The visit describes the act of a pet visiting the clinic with the help of its owner.</p>
</div>
<a href="https://raw.githubusercontent.com/cuba-platform/cuba-petclinic/master/img/cuba-petclinic-overview.gif"><img src="https://raw.githubusercontent.com/cuba-platform/cuba-petclinic/master/img/login-screen.png"/></a>
</div>
</div>
<div class="sect1">
<h2 id="direct_many_to_many_association"><a class="anchor" href="#direct_many_to_many_association"></a><a class="link" href="#direct_many_to_many_association">Direct Many-to-Many Association</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An example of direct many-to-many relationships is the following in the petclinic example:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/guides/images/data-model-many-to-many/direct_many_to_many.png" alt="direct many to many">
</div>
</div>
<div class="paragraph">
<p>A <code>Vet</code> can have multiple specialties and a <code>Speciality</code> on the other hand can also be linked to multiple vets.</p>
</div>
<div class="paragraph">
<p>On the database, it is represented as a Join Table, but there is <em>no</em> explicit entity defined as the joining entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the Studio entity designer, set the following settings for the <code>specialties</code> attribute: <strong>Attribute type</strong> - <code>ASSOCIATION</code>, <strong>Cardinality</strong> - <code>MANY_TO_MANY</code>. <code>Vet</code> will be marked as the owning side of the relationship, and Studio will suggest creating the corresponding <code>vets</code> attribute in the <code>Specialty</code> entity as the inverse side of the association.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/global/src/com/haulmont/sample/petclinic/entity/vet/Vet.java">Vet.java</a> - the <code>Vet</code> entity contains a many-to-many list of <code>specialties</code>.</p>
</div>
<div class="listingblock">
<div class="title">Vet.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JoinTable</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PETCLINIC_VET_SPECIALTY_LINK</span><span class="delimiter">&quot;</span></span>,
        joinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">VET_ID</span><span class="delimiter">&quot;</span></span>),
        inverseJoinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SPECIALTY_ID</span><span class="delimiter">&quot;</span></span>))
<span class="annotation">@ManyToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;Specialty&gt; specialties;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/global/src/com/haulmont/sample/petclinic/entity/vet/Specialty.java">Specialty.java</a> - the <code>Specialty</code> entity now contains the many-to-many list of <code>vets</code>: <strong>Attribute type</strong> - <code>ASSOCIATION</code>, <strong>Cardinality</strong> - <code>MANY_TO_MANY</code>.</p>
</div>
<div class="listingblock">
<div class="title">Specialty.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JoinTable</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PETCLINIC_VET_SPECIALTY_LINK</span><span class="delimiter">&quot;</span></span>,
        joinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SPECIALTY_ID</span><span class="delimiter">&quot;</span></span>),
        inverseJoinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">VET_ID</span><span class="delimiter">&quot;</span></span>))
<span class="annotation">@ManyToMany</span>
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;Vet&gt; vets;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Specialty</code> will be <em>also</em> marked by default as the owning side of the relationship, which enables modification of the collections on both sides.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/views.xml">views.xml</a> - the <code>vet-with-specialties</code> view of the vet editing screen contains the specialties association attribute with the <code>_minimal</code> view. The <code>specialty-with-vets</code> view includes the vets association as well.</p>
</li>
<li>
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/web/src/com/haulmont/sample/petclinic/web/vet/vet/vet-edit.xml">vet-edit.xml</a> - the XML descriptor of the vet editor defines a datasource for the <code>Vet</code> instance and a nested one for its specialties. It also contains a table displaying specialties and <a href="https://doc.cuba-platform.com/manual-latest/list_actions.html#addAction">add</a> and <a href="https://doc.cuba-platform.com/manual-latest/list_actions.html#removeAction">remove</a> actions.</p>
</li>
<li>
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/web/src/com/haulmont/sample/petclinic/web/vet/specialty/specialty-edit.xml">specialty-edit.xml</a> - the XML descriptor of the specialty editor defines a datasource for the <code>Specialty</code> instance and a nested one for its vets. It also contains a table displaying vets and <strong>add</strong> and <strong>remove</strong> actions .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, the <code>Vet</code> and the <code>Specialty</code> editors are absolutely symmetrical.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indirect_many_to_many_association_with_joining_entity"><a class="anchor" href="#indirect_many_to_many_association_with_joining_entity"></a><a class="link" href="#indirect_many_to_many_association_with_joining_entity">Indirect Many-to-Many Association with Joining Entity</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The many-to-many association is always implemented using a joining table, but creating an entity to reflect this table is optional. The joining entity can be created when some additional attributes should be stored in the joining table.</p>
</div>
<div class="paragraph">
<p>An example of an indirect many-to-many association is the following in the petclinic example:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/guides/images/data-model-many-to-many/indirect_many_to_many.png" alt="indirect many to many">
</div>
</div>
<div class="paragraph">
<p>A <code>Pet</code> might over the years be insured by different <code>InsuranceCompanies</code> and an <code>InsuranceCompany</code> on the other hand has multiple memberships.</p>
</div>
<div class="paragraph">
<p>On the database, it is represented as a Join Table and there <em>is</em> an explicit entity defined as the joining entity called <code>InsuranceMembership</code>. It also holds additional information about the membership: the validity range in which the Pet is insured by the insurance company. Therefore it has values <code>validFrom</code> and <code>validUntil</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the Studio entity designer, set the following settings for the <code>insuranceMemberships</code> attribute: <strong>Attribute type</strong> - <code>COMPOSITION</code>, <strong>Cardinality</strong> - <code>ONE_TO_MANY</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/global/src/com/haulmont/sample/petclinic/entity/pet/Pet.java">Pet.java</a> - the <code>Pet</code> entity contains a one-to-many composition of <code>InsuranceMembership</code> instances.</p>
</div>
<div class="listingblock">
<div class="title">Pet.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Composition</span>
<span class="annotation">@OnDelete</span>(DeletePolicy.CASCADE)
<span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">pet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;InsuranceMembership&gt; insurancesMemberships;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the Studio entity designer, set the following settings for the <code>memberships</code> attribute: <strong>Attribute type</strong> - <code>COMPOSITION</code>, <strong>Cardinality</strong> - <code>ONE_TO_MANY</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/global/src/com/haulmont/sample/petclinic/entity/insurance/InsuranceCompany.java">InsuranceCompany.java</a> - the <code>InsuranceCompany</code> entity contains a one-to-many composition of <code>InsuranceMembership</code> instances.</p>
</div>
<div class="listingblock">
<div class="title">InsuranceCompany.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Composition</span>
<span class="annotation">@OnDelete</span>(DeletePolicy.CASCADE)
<span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">insuranceCompany</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;InsuranceMembership&gt; memberships;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/global/src/com/haulmont/sample/petclinic/entity/insurance/InsuranceMembership.java">InsuranceMembership.java</a> - thus, the <code>InsuranceMembership</code> entity contains two many-to-one references: <code>pet</code> and <code>insuranceCompany</code>.</p>
</div>
<div class="listingblock">
<div class="title">InsuranceMembership.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotNull</span>
<span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY, optional = <span class="predefined-constant">false</span>)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PET_ID</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> Pet pet;

<span class="annotation">@NotNull</span>
<span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY, optional = <span class="predefined-constant">false</span>)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">INSURANCE_COMPANY_ID</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> InsuranceCompany insuranceCompany;

<span class="annotation">@Temporal</span>(TemporalType.DATE)
<span class="annotation">@NotNull</span>
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">VALID_FROM</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>)
<span class="directive">protected</span> <span class="predefined-type">Date</span> validFrom;

<span class="annotation">@Temporal</span>(TemporalType.DATE)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">VALID_UNTIL</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Date</span> validUntil;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/global/src/com/haulmont/sample/petclinic/views.xml">views.xml</a> - the <code>pet-with-owner-and-type-and-memberships</code> view of the pet editing screen contains the composition of <code>insuranceMemberships</code> (referencing the <code>InsuranceMembership</code> joining entity) with <code>insuranceCompany</code> and the additional validity information: <code>validFrom</code> and <code>validUntil</code>.</p>
<div class="paragraph">
<p>The <code>insuranceCompany-with-memberships</code> view follows the same logic: it includes the composition of <code>memberships</code> (referencing the <code>InsuranceMembership</code> joining entity) with <code>pet</code> and the additional validity information: <code>validFrom</code> and <code>validUntil</code>.</p>
</div>
</li>
<li>
<p><a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/web/src/com/haulmont/sample/petclinic/web/pet/pet/pet-edit.xml">pet-edit.xml</a> - the XML descriptor of the pet editor defines a data container for the <code>Pet</code> instance and a nested one for its <code>insuranceCompany</code> instances (through the <code>InsuranceMembership</code> relationship). It also contains a table displaying memberships and the custom action to pick an <code>InsuranceCompany</code> directly, bypassing the <code>InsuranceMembership</code> editor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, editing of an <code>InsuranceMembership</code> instance works as follows:</p>
</div>
<div class="paragraph">
<p>The <code>Pet</code> edit screen shows a list of insurance companies and the validity range of the membership.</p>
</div>
<div class="paragraph">
<p>A user can click <strong>Add Insurance</strong>, the <code>InsuranceCompany</code> lookup will be opened, and the user can either select an insurance company to add or create a new insurance company. When the user selects an insurance company, a new <code>InsuranceMembership</code> instance <a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/web/src/com/haulmont/sample/petclinic/web/pet/pet/PetEdit.java#L57">is created</a> with the default validity range. This instance is not saved to the database directly, but added to the <code>insurancesMembershipsDc</code> data container of the <code>Pet</code> editor.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When within the above described creation of a many-to-many relationship from the Pet editor an <code>InsuranceCompany</code> is created or updated through the <a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many/blob/master/modules/web/src/com/haulmont/sample/petclinic/web/insurance/insurancecompany/InsuranceCompanyEdit.java"><code>InsuranceCompany</code> editor</a>, the created / updated instance of the insurance company is directly saved to the database as the <code>InsuranceCompany</code> entity is fully independent. A user can create new insurance companies and delete existing ones. All changes will be saved to the database in separate transactions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a user clicks OK in the pet edit screen, the updated <code>Pet</code> instance together with all the updated <code>InsuranceMembership</code> instances is submitted to the <code>DataManager.commit()</code> method on the middleware and saved to the database within a single transaction.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a><a class="link" href="#summary">Summary</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this data modelling guide the many-to-many association was shown. Many-to-many associations are valuable if both sides of the association should be linked to multiple items of the other side as shown for the <code>Vet</code> &#8592;&#8594; <code>Specialty</code> case. If required by the business case, this association can be also enhanced via additional information that describes the association further as it was shown with the <code>validFrom</code> &amp; <code>validUntil</code> attributes for the <code>InsuranceMembership</code> entity.</p>
</div>
</div>
</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- Sidebar (right column) -->
            <div id="blog-sidebar">
                <div class="region region-sidebar ">
                    <section id="block-block-29" class="block block-block clearfix">

                        <div class="guide-panel">
                            <h3 class="header-table-content">Table of contents</h3>
                            <ul class="sectlevel1">
<li><a href="#what_will_be_built">What Will Be Built</a>
<ul class="sectlevel2">
<li><a href="#final_application">Final Application</a></li>
<li><a href="#requirements">Requirements</a></li>
</ul>
</li>
<li><a href="#example_cuba_petclinic">Example: CUBA petclinic</a></li>
<li><a href="#direct_many_to_many_association">Direct Many-to-Many Association</a></li>
<li><a href="#indirect_many_to_many_association_with_joining_entity">Indirect Many-to-Many Association with Joining Entity</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
                        </div>

                        <div class="sidebar-razd"></div>
                        <div class="guide-panel download">
                            <a href="https://github.com/cuba-guides/cuba-petclinic-data-model-many-to-many" class="github-link" target="_blank">Example code on Github</a>
                        </div>
                        <div class="guide-panel cuba-version">Supported versions: CUBA 7.0+; Java 8+</div>

                    </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer fragment="14269c1b298" class="footer">
    <div class="container footer_container">
        <div class="footer_columns">
            <div class="footer_column">
                <div class="footer-menu"><h4 class="footer-menu_label">Framework</h4>
                    <ul class="footer-menu_nav">
                        <li><a href="/framework/">Framework</a></li>
                        <li><a href="/tools/">Tools</a></li>
                        <li><a href="/marketplace/">Addons</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer_column">
                <div class="footer-menu"><h4 class="footer-menu_label">Learn</h4>
                    <ul class="footer-menu_nav">
                        <li><a href="/learn/quickstart/">Quick Start</a></li>
                        <li><a href="/learn/live-demo/">Live Demo</a></li>
                        <li><a href="/guides/">Guides</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer_column">
                <div class="footer-menu"><h4 class="footer-menu_label">Documentation</h4>
                    <ul class="footer-menu_nav">
                        <li><a href="/documentation/">Documentation</a></li>
                        <li><a href="/api-reference/">API References</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer_column">
                <div class="footer-menu"><h4 class="footer-menu_label">Community</h4>
                    <ul class="footer-menu_nav">
                        <li><a href="/discuss/">Forum</a></li>
                        <li><a href="/blog/">Blog</a></li>
                        <li><a href="/contacts/">Contacts</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer_bottom">
            <div class="footer_copyright">
                Developed and sponsored by Haulmont
                <a href="https://www.cuba-platform.com/terms-of-use/" class="footer_terms">Terms of Use</a></div>
            <ul class="social footer_social">
                <li class="social_item">
                    <a href="https://github.com/cuba-platform/cuba" target="_blank" class="social_link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon -github social_icon">
                        <path d="M3.047 3.188C5.109 1.062 7.594 0 10.5 0c2.906 0 5.383 1.055 7.43 3.164C19.977 5.274 21 7.812 21 10.781c0 2.344-.672 4.453-2.016 6.328-1.343 1.875-3.062 3.172-5.156 3.891h-.187c-.375 0-.563-.187-.563-.563l.024-1.054c.015-.672.023-1.29.023-1.852 0-.906-.25-1.578-.75-2.015 1.438-.188 2.602-.649 3.492-1.383.89-.735 1.336-2.04 1.336-3.914 0-1.125-.36-2.094-1.078-2.906.313-.907.281-1.86-.094-2.86h-.234c-.719 0-1.61.375-2.672 1.125a9.858 9.858 0 0 0-2.625-.375c-.844 0-1.719.125-2.625.375-1.063-.75-1.953-1.125-2.672-1.125H4.97c-.375 1-.407 1.953-.094 2.86-.719.812-1.078 1.78-1.078 2.906 0 1.875.437 3.18 1.312 3.914s2.032 1.195 3.47 1.383c-.345.343-.563.828-.657 1.453a2.687 2.687 0 0 1-1.219.281c-.781 0-1.39-.39-1.828-1.172-.406-.687-.953-1.062-1.64-1.125-.657 0-.673.219-.047.656.468.25.859.782 1.171 1.594.032.125.094.274.188.445.094.172.351.399.773.68.422.281.93.422 1.524.422.437 0 .781-.031 1.031-.094v1.828c0 .344-.172.516-.516.516h-.187c-2.125-.719-3.852-2.008-5.18-3.867C.664 15.273 0 13.156 0 10.78c0-2.969 1.016-5.5 3.047-7.594z" fill="currentColor" fill-rule="evenodd"></path>
                    </svg>
                </a></li>
                <li class="social_item">
                    <a href="https://www.linkedin.com/company/cuba-platform" target="_blank" class="social_link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon -linkedin social_icon">
                        <path d="M19.305 0c.474 0 .875.155 1.203.465.328.31.492.702.492 1.176v17.554c0 .474-.164.894-.492 1.258-.328.365-.73.547-1.203.547h-17.5c-.474 0-.894-.182-1.258-.547C.182 20.09 0 19.67 0 19.195V1.641C0 1.167.173.775.52.465.866.155 1.294 0 1.805 0h17.5zM6.775 17.613V8.129h-2.71v9.484h2.71zM4.431 6.407c.245.245.566.367.964.367s.728-.13.988-.39.39-.574.39-.942c0-.398-.122-.727-.367-.987s-.567-.39-.965-.39-.727.13-.987.39-.39.59-.39.987c0 .368.122.69.367.965zm13.18 11.206v-5.42c0-1.336-.305-2.348-.916-3.034-.612-.687-1.407-1.03-2.386-1.03-1.048 0-1.922.506-2.62 1.517v-1.3H8.806v9.267h2.884v-5.257c0-.361.034-.614.104-.759.28-.722.77-1.083 1.468-1.083.979 0 1.468.668 1.468 2.005v5.094h2.883z" fill="currentColor" fill-rule="evenodd"></path>
                    </svg>
                </a></li>
                <li class="social_item">
                    <a href="https://www.facebook.com/CUBAplatform" target="_blank" class="social_link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon -facebook social_icon">
                        <path d="M17.063 0A3.939 3.939 0 0 1 21 3.938v13.124A3.939 3.939 0 0 1 17.062 21h-2.57v-8.135h2.72l.411-3.172h-3.13V7.67c0-.916.245-1.531 1.571-1.531l1.668-.014v-2.83c-.287-.041-1.285-.123-2.433-.123-2.42 0-4.088 1.476-4.088 4.183v2.338H8.477v3.172h2.734V21H3.937A3.939 3.939 0 0 1 0 17.062V3.938A3.939 3.939 0 0 1 3.938 0h13.124z" fill="currentColor" fill-rule="evenodd"></path>
                    </svg>
                </a></li>
                <li class="social_item">
                    <a href="https://twitter.com/CubaPlatform" target="_blank" class="social_link">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon -twitter social_icon">
                            <path d="M17.5 6.59a6.058 6.058 0 0 1-1.654.465 2.903 2.903 0 0 0 1.271-1.6 5.717 5.717 0 0 1-1.832.697 2.847 2.847 0 0 0-2.092-.902 2.87 2.87 0 0 0-2.87 2.871c0 .219.013.451.068.656A8.158 8.158 0 0 1 4.457 5.77c-.246.423-.396.93-.396 1.449 0 .998.464 1.873 1.244 2.392-.479-.013-.93-.15-1.367-.355v.027c0 1.395 1.052 2.557 2.365 2.817-.246.068-.438.109-.698.109-.177 0-.355-.027-.533-.055a2.889 2.889 0 0 0 2.68 1.996A5.782 5.782 0 0 1 3.5 15.34a8.183 8.183 0 0 0 4.402 1.285c5.278 0 8.176-4.375 8.176-8.176 0-.123 0-.246-.014-.369A5.521 5.521 0 0 0 17.5 6.59zM21 3.938v13.124A3.939 3.939 0 0 1 17.062 21H3.938A3.939 3.939 0 0 1 0 17.062V3.938A3.939 3.939 0 0 1 3.938 0h13.124A3.939 3.939 0 0 1 21 3.938z" fill="currentColor" fill-rule="evenodd"></path>
                        </svg>
                    </a>
                </li>
                <li class="social_item">
                    <a href="https://www.youtube.com/c/CubaPlatform" target="_blank" class="social_link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon -youtube social_icon">
                        <path d="M27.836 4.648c.11 1.97.164 3.92.164 5.852 0 1.932-.055 3.883-.164 5.852 0 1.24-.392 2.287-1.176 3.144-.784.857-1.74 1.285-2.87 1.285-2.808.146-6.071.219-9.79.219-3.719 0-6.982-.073-9.79-.219-1.13 0-2.086-.428-2.87-1.285C.556 18.64.164 17.591.164 16.352.054 14.382 0 12.432 0 10.5c0-1.276.073-3.227.219-5.852 0-1.24.383-2.287 1.148-3.144C2.133.647 3.081.219 4.211.219 6.872.073 9.97 0 13.508 0h.984c3.537 0 6.636.073 9.297.219 1.13 0 2.087.428 2.871 1.285.784.857 1.176 1.905 1.176 3.144zM11.32 15.86l7.93-5.359-7.93-5.414v10.773z" fill="currentColor" fill-rule="evenodd"></path>
                    </svg>
                </a></li>
                <li class="social_item">
                    <a href="/rss.xml" class="social_link">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon -rss social_icon">
                            <path d="M.857 15.91C1.464 15.305 2.18 15 3 15c.821 0 1.527.295 2.116.884.59.59.884 1.295.884 2.116 0 .821-.295 1.527-.884 2.116-.59.59-1.295.884-2.116.884-.821 0-1.527-.295-2.116-.884C.294 19.526 0 18.821 0 18c0-.821.286-1.518.857-2.09zM0 7c3.828 0 7.118 1.376 9.871 4.129C12.624 13.882 14 17.172 14 21H9.625c0-2.917-.875-5.25-2.625-7s-4.083-2.625-7-2.625V7zm0-7c5.797 0 10.746 2.05 14.848 6.152C18.949 10.254 21 15.203 21 21h-4.375c0-4.667-1.604-8.604-4.813-11.813C8.604 5.98 4.668 4.375 0 4.375V0z" fill="currentColor" fill-rule="evenodd"></path>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</footer>
<!--<script src="https://cuba-nuxt.demo.haulmont.com/_nuxt/83f852ef4b5c91802566.js" defer></script>
<script src="https://cuba-nuxt.demo.haulmont.com/_nuxt/d3a40ea16eeb2e16777d.js" defer></script>
<script src="https://cuba-nuxt.demo.haulmont.com/_nuxt/9bd7e05c04e06e762b47.js" defer></script>
<script src="https://cuba-nuxt.demo.haulmont.com/_nuxt/70ff0a2e2f971caf4892.js" defer></script>
<script src="https://cuba-nuxt.demo.haulmont.com/_nuxt/cf082d0abe0e606c10b9.js" defer></script>-->
<style>
    [class*="column"] + [class*="column"]:last-child {
        float: none;
    }
</style>


<!-- BEGIN FOOTER -->
<!--<footer id="footer">
    <div class="footer-wrapper cuba-container">
        <div class="region region-footer-sitemap">
            <section id="block-footer-sitemap-footer-sitemap" class="block block-footer-sitemap clearfix">
                <div id="footer-sitemap" class="clearfix">
                    <div class="fs-block-content">
                        <div class="menu-footer-sitemap">
                            <ul class="footer_links_menu-footer-sitemap total-items-5 parent-items-0 single-items-0">
                                <li class="menu-1466 depth-1 total-children-4 parent-children-0 single-children-4  first">
                                    <a href="/framework" class="fs-root-link">Platform</a>
                                    <ul class="footer_links_menu-footer-sitemap total-items-4 parent-items-0 single-items-0">
                                        <li class="menu-2770 depth-2 fs-no-children  first"><a href="/framework">The Framework</a></li>
                                        <li class="menu-1473 depth-2 fs-no-children"><a href="/development-tools">Development Tools</a></li>
                                        <li class="menu-2838 depth-2 fs-no-children last"><a href="/marketplace">Marketplace</a></li>
                                    </ul>
                                </li>
                                <li class="menu-1469 depth-1 total-children-7 parent-children-0 single-children-7">
                                    <a href="/online-demo" class="fs-root-link">Learn</a>
                                    <ul class="footer_links_menu-footer-sitemap total-items-7 parent-items-0 single-items-0">
                                        <li class="menu-1479 depth-2 fs-no-children first"><a href="/online-demo">Online demo</a></li>
                                        <li class="menu-1477 depth-2 fs-no-children"><a href="/quickstart">Quick start</a></li>
                                        <li class="menu-1478 depth-2 fs-no-children"><a href="/documentation">Documentation</a></li>
                                        <li class="menu-1731 depth-2 fs-no-children"><a href="/guides">Guides</a></li>
                                        <li class="menu-1773 depth-2 fs-no-children"><a href="/webinars">Webinars</a></li>
                                        <li class="menu-1602 depth-2 fs-no-children last"><a href="/faq">FAQ</a></li>
                                    </ul>
                                </li>
                                <li class="menu-1603 depth-1 total-children-3 parent-children-0 single-children-3"><a
                                        href="https://www.cuba-platform.com/discuss/" class="fs-root-link">Community</a>
                                    <ul class="footer_links_menu-footer-sitemap total-items-3 parent-items-0 single-items-0">
                                        <li class="menu-1604 depth-2 fs-no-children first"><a href="https://www.cuba-platform.com/discuss/">Forum</a></li>
                                        <li class="menu-1692 depth-2 fs-no-children"><a href="/testimonials">Customer stories</a></li>
                                        <li class="menu-1615 depth-2 fs-no-children last"><a href="/blog">Blog</a></li>
                                    </ul>
                                </li>
                                <li class="menu-1663 depth-1 total-children-3 parent-children-0 single-children-3"><a
                                        href="/training" class="fs-root-link">Services</a>
                                    <ul class="footer_links_menu-footer-sitemap total-items-3 parent-items-0 single-items-0">
                                        <li class="menu-1756 depth-2 fs-no-children first"><a href="/training">Training</a></li>
                                        <li class="menu-1757 depth-2 fs-no-children"><a href="/support-options">Support</a></li>
                                        <li class="menu-1758 depth-2 fs-no-children last"><a href="/deployment">Development</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="menu-1612 depth-1 total-children-3 parent-children-0 single-children-3  last">
                                    <a href="/download" class="fs-root-link">More</a>
                                    <ul class="footer_links_menu-footer-sitemap total-items-3 parent-items-0 single-items-0">
                                        <li class="menu-2773 depth-2 fs-no-children first"><a href="/download">Download</a></li>
                                        <li class="menu-2775 depth-2 fs-no-children"><a href="/store">Store</a></li>
                                        <li class="menu-1480 depth-2 fs-no-children last"><a href="/contacts">Contacts</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </section>
        </div>
        <div class="region region-footer-copyright">
            <section id="block-block-14" class="block block-block clearfix">
                <div class="footer-copyright">
                    <div class="copyright">Copyright &copy; 2008-2018 Haulmont</div>
                    <div class="licences"><a href="/terms-of-use">Terms of Use</a></div>
                    <div class="socials">
                        <ul>
                            <li><a href="https://github.com/cuba-platform/cuba" class="socials-icon github"></a></li>
                            <li><a href="https://www.youtube.com/c/CubaPlatform" class="socials-icon youtube"></a></li>
                            <li><a href="https://www.facebook.com/CUBAplatform" class="socials-icon facebook"></a></li>
                            <li><a href="https://twitter.com/CubaPlatform" class="socials-icon twitter"></a></li>
                            <li><a href="https://www.linkedin.com/company/cuba-platform" class="socials-icon linkedin"></a></li>
                            <li><a href="https://www.cuba-platform.com/rss.xml" class="socials-icon rss"></a></li>
                        </ul>
                    </div>
                </div>
                <script async defer src="https://buttons.github.io/buttons.js"></script>
            </section>
        </div>
    </div>
</footer>-->
<!-- END FOOTER -->
<div class="scrollTop"></div>
</section>

<script src="/guides/js/foundation.min.js"></script>
<script src="https://unpkg.com/isotope-layout@3.0/dist/isotope.pkgd.js"></script>
<script src="/guides/js/vendor/modernizr.js"></script>
<script src="/guides/js/toc.js"></script>
<script src="/guides/js/navigation.js"></script>
<script src="/guides/js/navbar.js"></script>
<script src="/guides/js/extra.js"></script>
<script src="/guides/js/extra2.js"></script>
<script src="/guides/js/cuba-new.js"></script>
<script>
(function ($) {
  $(document).foundation();
  var doc = document.documentElement;
  doc.setAttribute('data-useragent', navigator.userAgent)

  /* Issue #24 */
  $(".blog .content img").each(function() {
    var imgMarkup = $(this)[0].outerHTML;
    console.log(imgMarkup);
    $(this).replaceWith('<div class="img-center">' + imgMarkup + '</div>');
  });

})(jQuery);

// Cache selectors
var lastId,
    topMenu = $(".sectlevel1"),
    topMenuHeight = topMenu.outerHeight()+1,

    // All list items
    menuItems = topMenu.find("a"),
    // Anchors corresponding to menu items
    scrollItems = menuItems.map(function(){
        var item = $($(this).attr("href"));
        if (item.length) { return item; }
    });
console.log(topMenuHeight );
menuItems.click(function(e){
    var href = $(this).attr("href"),
        offsetTop = href === "#" ? 0 : $(href).offset().top - 85;
    $('html, body').stop().animate({
        scrollTop: offsetTop
    }, 850);
    e.preventDefault();
    window.location =  href;
});

$( document ).ready(function() {
    const hash = location.hash.replace('#','');
    if(hash !== ''){
        $('html, body').stop().animate({ scrollTop: $('a[href=#' + hash + ']').offset().top - 85}, 850);
    }
});

// Bind to scroll
$(window).scroll(function(){
    // Get container scroll position
    var fromTop = $(this).scrollTop()+topMenuHeight;

    // Get id of current scroll item
    var cur = scrollItems.map(function(){
        if ($(this).offset().top < fromTop)
            return this;
    });
    // Get the id of the current element
    cur = cur[cur.length-1];
    var id = cur && cur.length ? cur[0].id : "";

    if (lastId !== id) {
        lastId = id;
        // Set/remove active class
        menuItems
            .parent().removeClass("active")
            .end().filter("[href=#"+id+"]").parent().addClass("active");
    }
});

</script>
</body>
</html>
